{{ define "main" }}

<!-- Feature post by tag = "feature" -->

{{- range where .Site.RegularPages "Params.tags" "intersect" (slice "feature" ) | first 1 -}}
<section class="block md:flex relative group p-6 lg:p-10 space-y-6 md:space-x-6 my-14 bg-zinc-100 rounded-3xl hover:bg-blue-100">
  <figure class="basis-1/2 w-full aspect-video overflow-hidden rounded-2xl border">

    {{- if .Params.image }}

      {{- if (strings.HasPrefix .Params.image "http") }}

        <img class="object-cover group-hover:scale-105 transition duration-500 cursor-pointer" src="{{ .Params.image }}" alt="{{ $.Name }}" style="width: 100%; height: 100%; object-fit: cover;">

      {{- else }}

        {{- with $imgfeature := resources.Get .Params.image }}
          {{ $imgfeature := $imgfeature.Resize "720x Q85" -}}
          <img class="object-cover group-hover:scale-105 transition duration-500 cursor-pointer" src="{{ $imgfeature.Permalink }}" alt="{{ $.Name }}" width="{{ $imgfeature.Width }}" height="{{ $imgfeature.Height }}">
        {{- end }}

      {{- end }}

    {{- end }}

  </figure>
  <div class="basis-1/2 self-center">
    <h2 class="text-2xl md:text-3xl lg:text-5xl font-bold mb-4"><a class="before:content-[''] before:z-10 before:top-0 before:right-0 before:left-0 before:bottom-0 before:absolute before:pointer-events-auto" href="{{ .Permalink }}">{{ .Title}}</a></h2>
    <time datetime="{{ .Date.Format "2006-01-02T15:04:05-07:00" | safeHTML }}"><span class="font-bold">{{ .Date.Format "Jan 02, 2006" }}</span></time>
  </div>
</section>

{{ end -}}

<!-- / End feature post  -->

<!-- 에디터 픽 / Featured posts by tag (homeTag, e.g. "에디터 픽") -->

<section class="mb-16">

    {{ $tag := default "best" site.Params.homeTag }}
    {{ $tagTitle := default "Best" site.Params.homeTagTitle | default (title $tag) }}
    {{ $tagPage := .Site.GetPage (printf "/tags/%s" $tag) }}

    <div class="flex items-center mb-6">

      <h2 class="text-3xl md:text-4xl font-bold mr-auto">{{ $tagTitle }}</h2>

      {{ if $tagPage }}
      <a class="border rounded-full py-2 px-4 md:px-6 hover:bg-blue-100" href="{{ $tagPage.RelPermalink }}">View All</a>
      {{ else }}
      <a class="border rounded-full py-2 px-4 md:px-6 hover:bg-blue-100" href="{{ printf "/tags/%s/" $tag | relURL }}">View All</a>
      {{ end }}
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-x-6 gap-y-10">

    {{ $pages := where .Site.RegularPages "Params.tags" "intersect" (slice $tag (title $tag)) | first 3 }}
    {{ range $pages }}

      {{- partial "content/card" . -}}

    {{ end }}

    </div>

  </section>

<!-- / End Best post --> 
<hr class="my-8">
<!-- Start recent post: 홈에는 N개만 노출, View All → /posts/ (날짜순 전체) -->

  <section id="recent-posts" class="mb-16">

    <div class="flex items-center mb-6">
      <h2 class="text-3xl md:text-4xl font-bold mr-auto">최신글</h2>
      {{ $postsPage := .Site.GetPage "/posts" }}
      {{ if $postsPage }}
      <a class="border rounded-full py-2 px-4 md:px-6 hover:bg-blue-100" href="{{ $postsPage.RelPermalink }}">View All</a>
      {{ else }}
      <a class="border rounded-full py-2 px-4 md:px-6 hover:bg-blue-100" href="{{ "posts" | relURL }}">View All</a>
      {{ end }}
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-x-6 gap-y-10">

    {{ $recentN := default 6 site.Params.recentPostsOnHome }}
    {{ range (where site.RegularPages "Type" "in" site.Params.mainSections | first $recentN) }}

      {{- partial "content/card" . -}}

    {{ end }}

    </div>

  </section>

<!-- / End recent post  -->
<hr class="my-8">
<!-- 인기글 (태그: popular). 작동 확인 후 이 블록 전체를 주석 처리하면 숨김 -->
  <!-- <section class="mb-16">
    {{ $popularTag := default "popular" site.Params.homePopularTag }}
    {{ $popularTitle := default "인기글" site.Params.homePopularTagTitle | default (title $popularTag) }}
    {{ $popularPage := .Site.GetPage (printf "/tags/%s" $popularTag) }}
    <div class="flex items-center mb-6">
      <h2 class="text-3xl md:text-4xl font-bold mr-auto">{{ $popularTitle }}</h2>
      {{ if $popularPage }}
      <a class="border rounded-full py-2 px-4 md:px-6 hover:bg-blue-100" href="{{ $popularPage.RelPermalink }}">View All</a>
      {{ else }}
      <a class="border rounded-full py-2 px-4 md:px-6 hover:bg-blue-100" href="{{ printf "/tags/%s/" $popularTag | relURL }}">View All</a>
      {{ end }}
    </div>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-x-6 gap-y-10">
    {{ $popularPages := where .Site.RegularPages "Params.tags" "intersect" (slice $popularTag (title $popularTag)) | first 3 }}
    {{ range $popularPages }}
      {{- partial "content/card" . -}}
    {{ end }}
    </div>
  </section> -->
<!-- / End 인기글 -->

  {{- partial "content/newsletter.html" . -}}

{{ end }}
